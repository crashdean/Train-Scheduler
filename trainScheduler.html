<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="UTF-8">

    <title>Train Scheduler</title>

    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="assets/css/style.css" rel="stylesheet" type="text/css">
</head>

<body>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4">Train Scheduler</h1>
            <p class="lead"></p>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Current Time Schedule</h5>
            <div class="displayField">
                <table class=displayAlign>
                    <tr>
                        <th>Train Name</th>
                        <th>Destination</th>
                        <th>Frequency (min)</th>
                        <th>Next Arival</th>
                        <th>Minutes Away</th>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Add Train</h5>
            <form>
                <div class="trainName">
                    <label for="exampleFormControlInput1">Train Name:</label>
                    <input type="text" class="form-control" id="inputTrain" placeholder="Ex: Silver Bullet">
                </div>
                <div class="destinationName">
                    <label for="exampleFormControlInput1">Destination:</label>
                    <input type="text" class="form-control" id="inputDestination" placeholder="Ex: Denver">
                </div>
                <div class="firstTrainTime">
                    <label for="exampleFormControlInput1">First Train Time:</label>
                    <input type="text" class="form-control" id="inputTrainTime" placeholder="(HH:mm-miltary time)">
                </div>
                <div class="frequency">
                    <label for="exampleFormControlInput1">Frequency:</label>
                    <input type="text" class="form-control" id="inputFrequency" placeholder="(min)">
                </div>
                <br>
                <button class="btn btn-primary submit">Submit</button>
            </form>
        </div>
    </div>

    <!-- <script type="/assets/javaScripts/train.js"></script> -->

    <script>


        var config = {
            apiKey: "AIzaSyC6al9VoMnGoNCw474V3jmrz0ijp81GQMU",
            authDomain: "train-cf625.firebaseapp.com",
            databaseURL: "https://train-cf625.firebaseio.com",
            projectId: "train-cf625",
            storageBucket: "train-cf625.appspot.com",
            messagingSenderId: "199908478983"
        };

        firebase.initializeApp(config);

        var database = firebase.database();

        $(".submit").on('click', function (event) {
            event.preventDefault()
            var trainNam = $("#inputTrain").val();
            var destinationNam = $("#inputDestination").val();
            var firstTrain = $('#inputTrainTime').val();
            var frequencyTime = $('#inputFrequency').val();

            console.log(trainNam)
            console.log(destinationNam)
            console.log(firstTrain)
            console.log(frequencyTime)

            database.ref().push({
                train: trainNam,
                destination: destinationNam,
                firstTrain: firstTrain,
                frequency: frequencyTime,
                dateAdded: firebase.database.ServerValue.TIMESTAMP
            });
        })

        database.ref().on("child_added", function(snapshot) {
          console.log(snapshot.val().train);
          console.log(snapshot.val().destination);
          console.log(snapshot.val().firstTrain);
          console.log(snapshot.val().frequency);
       
        var tempTime = snapshot.val().firstTrain;
        var tFrequency = snapshot.val().frequency;
        // var firstTimeConverted = moment(tempTime, "HH:mm")
    console.log(tempTime);

        // var tempFormat = "HH:mm";
        // console.log(tempFormat);
        // var convertedDate = moment(tempDate, tempFormat);

        // console.log(moment().diff(convertedDate, "months"));
        // var monthsWorked = moment().diff(convertedDate, "months");
        // var totalBilled = monthsWorked * snapshot.val().monthlyRate;

    // var tFrequency = frequency

        var firstTimeConverted = moment(tempTime, "HH:mm").subtract(1, "years");
    console.log(firstTimeConverted);


        var currentTime = moment();
    console.log("CURRENT TIME: " + moment(currentTime).format("HH:mm"));

    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
    console.log("DIFFERENCE IN TIME: " + diffTime);

    var tRemainder = diffTime % tFrequency;
    console.log(tRemainder);

    var minutesAway = tFrequency - tRemainder;
    console.log("MINUTES TILL TRAIN: " + minutesAway);

    var nextArrival = moment().add(minutesAway, "minutes");
    console.log("ARRIVAL TIME: " + moment(nextArrival).format("hh:mm"));
    var arrivalTime = moment(nextArrival).format("HH:mm");
    console.log(arrivalTime);

        $("table").append("<tr><td>" +
          snapshot.val().train + "</td><td>" + snapshot.val().destination + 
          "</td><td>" + snapshot.val().frequency + "</td><td>" + arrivalTime + "</td><td>" +
           minutesAway + "</td><td>");

        }, function(errorObject) {
          console.log("Errors handled: " + errorObject.code);
        });




        // database.ref().on("child_added", function (snapshot) {
        //     console.log(snapshot.val().name);
        //     console.log(snapshot.val().role);
        //     console.log(snapshot.val().startDate);
        //     console.log(snapshot.val().monthlyRate);

        // var tempDate = snapshot.val().startDate;
        // var tempFormat = "MM/DD/YYYY";
        // var convertedDate = moment(tempDate, tempFormat);

        // console.log(moment().diff(convertedDate, "months"));
        // var monthsWorked = moment().diff(convertedDate, "months");
        // var totalBilled = monthsWorked * snapshot.val().monthlyRate;

        // $("table").append("<tr><td>" +
        //   snapshot.val().name + "</td><td>" + snapshot.val().role + "</td><td>" + 
        //   snapshot.val().startDate + </td><td>" + snapshot.val().monthlyRate + "</td><td>$" + totalBilled + "</td></tr>");

        // }, function(errorObject) {
        //   console.log("Errors handled: " + errorObject.code);
        // });

    </script>


</body>


</html>